<!DOCTYPE html>
<html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- 引入样式  th:src="@{/web/seehot/categoryedit.js}"-->
    <link rel="stylesheet" href="/js/ele/index.css" media="all">
    <link rel="stylesheet" href="/js/layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="/js/common.css" media="all">
    <style type="text/css">
        .upload-item .el-upload__tip {
            line-height: 8px !important;
        }
        .app-container {
            padding: 30px;
        }
        .el-form-item__content {
            margin-left: 70px !important;
        }
        .el-form-item__label {
            line-height: 20px !important;
        }
    </style>
</head>
<body id="main">

<div id="app" v-cloak>
    <div class="app-container">
        <!-- 新增编辑视频 -->

        <el-form ref="form" label-width="70px">
            <el-form-item label="新闻标题">
                <el-input v-model="title" placeholder="请输入标题"></el-input>
            </el-form-item>
            <el-form-item label="新闻内容">
                <textarea id="text"></textarea>
            </el-form-item>
            <el-form-item class="ele-form-center" style="display: flex;justify-content: center;margin: 20px 0;">
                <el-button type="primary" @click="dialogSubmit">{{type=='add'?'立即新增':'立即修改'}}</el-button>
                <el-button @click="dialogClose">取消</el-button>
            </el-form-item>
        </el-form>
    </div>
</div>
</body>
<!-- 先引入 Vue -->
<script src="/js/ele/vue.js"></script>
<script src="/js/common/common-mixin.js"></script>
<!-- 引入组件库 -->
<script src="/js/ele/index.js"></script>
<script src="/js/layui/layui.js"></script>
<script src="/js/jquery-3.4.1.min.js"></script>
<script>
    layui.use(['layedit'], function() {
        var form = layui.form,
            layer = parent.layer === undefined ? layui.layer : top.layer,
            $ = layui.jquery;
        new Vue({
            el: '#app',
            data: function() {
                return {
                    notesText: '', // 神段子
                    type: '',
                    title: '',
                    dailyNotesId: '',
                    fileList: []
                }
            },
            mounted() {
                layedit = layui.layedit;
                // this.type = this.getQueryString('type');
                this.layeditIndex = layedit.build('text', {
                    tool: ['strong'],
                    height: 120
                }); //建立编辑器
                // debugger;
                // if (this.type == 'edit') {
                //     let news = JSON.parse(localStorage.getItem("tempNews"));
                //     this.title = news.title;
                //     this.newsId = news.newsId;
                //     layedit.setContent(this.layeditIndex,news.text);
                // };
            },
            methods: {
                randomString: function(randomLen, min, max){
                    var str = "",
                        range = min,
                        arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
                            'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k',
                            'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
                            'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F',
                            'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
                            'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
                    // 随机产生
                    if(randomLen){
                        range = Math.round(Math.random() * (max-min)) + min;
                    }
                    for(var i=0; i<range; i++){
                        pos = Math.round(Math.random() * (arr.length-1));
                        str += arr[pos];
                    }
                    return str;
                },
                /**
                 * 弹窗数据提交
                 */
                dialogSubmit() {
                    let that = this;
                    let text = layedit.getContent(this.layeditIndex);
                    if (!text) {
                        this.$message.error('请选择填写完整！');
                        return;
                    }
                    const loading = this.$loading({
                        lock: true,
                        text: '数据提交中，请等待！',
                        spinner: 'el-icon-loading',
                        background: 'rgba(0, 0, 0, 0.3)'
                    });
                    // // 提交数据
                    // if (that.newsId) {
                    //     let formData = new FormData();
                    //     formData.append("requestId", this.randomString(false, 30));
                    //     formData.append("token", localStorage.getItem('amToken'));
                    //     formData.append("title", this.title);
                    //     formData.append("text", text);
                    //     formData.append("type", "医疗新闻");
                    //     formData.append("timestamp", Date.parse(new Date()));
                    //     formData.append("newsId", this.newsId);
                    //     $.ajax({
                    //         url:"http://www.aimang.info:8088/api/web/news/update",
                    //         contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    //         type : 'POST',
                    //         data : formData,
                    //         contentType : false,
                    //         processData : false,
                    //         cache : false,
                    //         success:function(data){
                    //             loading.close();
                    //             if (data.code == 0) {
                    //                 that.$message({
                    //                     message: '恭喜你，信息提交成功了！',
                    //                     type: 'success'
                    //                 });
                    //                 that.dialogClose();
                    //             } else {
                    //                 that.$message.error(data.msg);
                    //             }
                    //         }
                    //     });
                    // } else {
                        let formData = new FormData();
                        formData.append("requestId", this.randomString(false, 30));
                        formData.append("token", localStorage.getItem('amToken'));
                        formData.append("title", this.title);
                        formData.append("text", text);
                        formData.append("type", "医疗新闻");
                        formData.append("timestamp", Date.parse(new Date()));
                        $.ajax({
                            url : 'http://www.aimang.info:8088/api/web/news',
                            contentType: "application/x-www-form-urlencoded; charset=utf-8",
                            type : 'POST',
                            data : formData,
                            contentType : false,
                            processData : false,
                            cache : false,
                            success : function(data) {
                                loading.close();
                                if (data.code == 0) {
                                    that.$message({
                                        message: '恭喜你，信息提交成功了！',
                                        type: 'success'
                                    });
                                    that.dialogClose();
                                } else {
                                    that.$message.error(data.msg);
                                }
                            }
                        });
                    // }
                },
                /**
                 * 关闭弹窗
                 */
                dialogClose() {
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                }
            }
        })
    })

</script>
</html>
